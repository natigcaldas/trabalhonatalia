---
title: "T√≠tulos Constitucionais"
author: "Nat·lia Grassano Caldas"
date: "17 de janeiro de 2019"
output: html_document
---

##Introdu√ß√£o

**(TEXTO DESCREVENDO A PESQUISA)**

##An√°lise dos dados

Os dados a serem analisados est√£o no arquivo *titulos_STF.csv*. O conjunto de dados √© formado por 11 colunas. A primeira coluna apresenta o n√∫mero da ADIN. A segunda coluna apresenta o tempo que a ADIN permaneceu fora de pauta. As demais colunas representam T√≠tulos, numerados de I a IV, sendo que se o valor de uma ADIN na coluna de um determinado T√≠tulo for igual a 1, ent√£o ela faz parte desse T√≠tulo; se for zero, ent√£o ela n√£o parte desse T√≠tulo.

```{r leitura,autodep=TRUE}
#Pacotes
library(plyr)
suppressMessages(library(tidyverse))
library(knitr)
library(ggplot2)
suppressMessages(library(gridExtra))
suppressMessages(library(gamlss))

#Par√¢metros para gr√°ficos
titles <- theme(strip.text = element_text(size = 12), axis.text = element_text(size = 12,color = "black"),                   axis.title = element_text(size = 14), legend.text = element_text(size = 14),
                legend.title = element_text(size = 14), panel.grid.major = element_blank(),
                panel.grid.minor = element_blank(), panel.border = element_blank(),
                panel.background = element_rect(fill="white",size=0.5, linetype="solid",color = "black"),
                legend.background = element_rect(fill="white",size=0.5, linetype="solid",color = "black"),
                legend.position="bottom",legend.spacing.x = unit(0.5, 'cm'))

#Trocar pelo seu working directory
setwd("~/GDrive/Assessoria Estat√≠stica/Estat√≠stica/2019/Natalia Caldas (JAN2019)/Dados")
dados <- read.csv(file = "titulos_STF.csv")

#Organizando os dados
dados$ADINS <- factor(dados$ADINS)
for(i in 3:11){
  dados[,i] <- as.factor(dados[,i])
  dados[,i] <- mapvalues(dados[,i],c("0","1"),c("N√£o","Sim"))
}

#Excluindo um outilier
dados <- dados %>% filter(TEMPO < max(TEMPO))

head(dados)
```

O objetivo das an√°lises ser√° verificar se os temas das A√ß√µes Diretas de Inconstitucionalidade que ainda n√£o foram julgadas influenciam diretamente no tempo em que estas permanecem sem serem inclu√≠das em pauta de julgamento. Para tanto, iremos analisar o conjunto de dados descritivamente e ajustaremos um modelo aos dados para determinar se h√° uma influ√™ncia estatisticamente significativa do t√≠tulo de uma ADIN no tempo que ela permanece fora de pauta.

###An√°lise Descritiva

#####T√≠tulo I
```{r titulo I,fig.align='center'}
#Medidas resumos que iremos utilizar
estatisticas <- list("N" = length,"M√©dia" = mean,"DesvioPadr√£o" = sd,"M√≠nimo" = min,
                     "1Quartil" = function(x) quantile(x = x,probs = 0.25),
                     "Mediana" = median,"3Quartil" = function(x) quantile(x = x,probs = 0.75),
                     "M√°ximo" = max)

#Calcula as medidas resumo para uma vari√°vel x
resumo <- function(x){
    r <- vector()
    for(i in 1:length(estatisticas))
      r[i] <- estatisticas[[i]](x)
    names(r) <- names(estatisticas)
    return(r)
}

#Medidas resumo do tempo fora de pauta por presen√ßa ou n√£o do t√≠tulo I
t <- do.call(rbind,tapply(X = dados$TEMPO,INDEX = dados$TI,FUN = resumo))
kable(t)

#Box-plot do tempo por presen√ßa ou n√£o do t√≠tulo I
ggplot(dados,aes(x = TI,y = TEMPO)) + geom_boxplot() + theme_linedraw() + titles + xlab("T√≠tulo I") + ylab("Tempo")

#O c√≥digo para os demais t√≠tulos √© an√°logo, trocando apenas TI pelo t√≠tulo que se quer
```

#####T√≠tulo II
```{r titulo II,echo = FALSE,fig.align='center'}
#Medidas resumo do tempo fora de pauta por presen√ßa ou n√£o do t√≠tulo II
t <- do.call(rbind,tapply(X = dados$TEMPO,INDEX = dados$TII,FUN = resumo))
kable(t)

#Box-plot do tempo por presen√ßa ou n√£o do t√≠tulo II
ggplot(dados,aes(x = TII,y = TEMPO)) + geom_boxplot() + theme_linedraw() + titles + xlab("T√≠tulo II") + ylab("Tempo")

```

#####T√≠tulo III
```{r titulo III,echo = FALSE,fig.align='center'}
#Medidas resumo do tempo fora de pauta por presen√ßa ou n√£o do t√≠tulo III 
t <- do.call(rbind,tapply(X = dados$TEMPO,INDEX = dados$TIII,FUN = resumo))
kable(t)
#Box-plot do tempo por presen√ßa ou n√£o do t√≠tulo III
ggplot(dados,aes(x = TIII,y = TEMPO)) + geom_boxplot() + theme_linedraw() + titles + xlab("T√≠tulo III") + ylab("Tempo")

```

#####T√≠tulo IV
```{r titulo IV,echo = FALSE,fig.align='center'}
#Medidas resumo do tempo fora de pauta por presen√ßa ou n√£o do t√≠tulo IV
t <- do.call(rbind,tapply(X = dados$TEMPO,INDEX = dados$TIV,FUN = resumo))
kable(t)

#Box-plot do tempo por presen√ßa ou n√£o do t√≠tulo IV
ggplot(dados,aes(x = TIV,y = TEMPO)) + geom_boxplot() + theme_linedraw() + titles + xlab("T√≠tulo IV") + ylab("Tempo")

```

#####T√≠tulo V
```{r titulo V,echo = FALSE,fig.align='center'}
#Medidas resumo do tempo fora de pauta por presen√ßa ou n√£o do t√≠tulo V
t <- do.call(rbind,tapply(X = dados$TEMPO,INDEX = dados$TV,FUN = resumo))
kable(t)

#Box-plot do tempo por presen√ßa ou n√£o do t√≠tulo V
ggplot(dados,aes(x = TV,y = TEMPO)) + geom_boxplot() + theme_linedraw() + titles + xlab("T√≠tulo V") + ylab("Tempo")

```

#####T√≠tulo VI
```{r titulo VI,echo = FALSE,fig.align='center'}
#Medidas resumo do tempo fora de pauta por presen√ßa ou n√£o do t√≠tulo VI
t <- do.call(rbind,tapply(X = dados$TEMPO,INDEX = dados$TVI,FUN = resumo))
kable(t)

#Box-plot do tempo por presen√ßa ou n√£o do t√≠tulo VI
ggplot(dados,aes(x = TVI,y = TEMPO)) + geom_boxplot() + theme_linedraw() + titles + xlab("T√≠tulo VI") + ylab("Tempo")

```

#####T√≠tulo VII
```{r titulo VII,echo = FALSE,fig.align='center'}
#Medidas resumo do tempo fora de pauta por presen√ßa ou n√£o do t√≠tulo VII
t <- do.call(rbind,tapply(X = dados$TEMPO,INDEX = dados$TVII,FUN = resumo))
kable(t)

#Box-plot do tempo por presen√ßa ou n√£o do t√≠tulo VII
ggplot(dados,aes(x = TVII,y = TEMPO)) + geom_boxplot() + theme_linedraw() + titles + xlab("T√≠tulo VII") + ylab("Tempo")
```

#####T√≠tulo VIII
```{r titulo VIII,echo = FALSE,fig.align='center'}
#Medidas resumo do tempo fora de pauta por presen√ßa ou n√£o do t√≠tulo VIII
t <- do.call(rbind,tapply(X = dados$TEMPO,INDEX = dados$TVII,FUN = resumo))
kable(t)

#Box-plot do tempo por presen√ßa ou n√£o do t√≠tulo VIII
ggplot(dados,aes(x = TVIII,y = TEMPO)) + geom_boxplot() + theme_linedraw() + titles + xlab("T√≠tulo VIII") + ylab("Tempo")
```

#####T√≠tulo IX
```{r titulo IX,echo = FALSE,fig.align='center'}
#Medidas resumo do tempo fora de pauta por presen√ßa ou n√£o do t√≠tulo IX
t <- do.call(rbind,tapply(X = dados$TEMPO,INDEX = dados$TIX,FUN = resumo))
kable(t)

#Box-plot do tempo por presen√ßa ou n√£o do t√≠tulo IX
ggplot(dados,aes(x = TIX,y = TEMPO)) + geom_boxplot() + theme_linedraw() + titles + xlab("T√≠tulo IX") + ylab("Tempo")

```

###Modelos Estat√≠sticos

Agora iremos ajustar um modelo de regress√£o para o tempo fora de pauta cujas vari√°veis explicativas ser√£o a presen√ßa ou n√£o de cada t√≠tulo. Come√ßamos ajustando um Modelo de Regress√£o Linear Normal. Pela an√°lise de res√≠duos vemos que este modelo n√£o est√° bem ajustado. De fato, analisando-se o gr√°fico QQ-plot dos res√≠duos padronizados pelos quantis te√≥ricos, tem-se que os pontos n√£o est√£o bem ajustados sobre a reta diagonal, apresentando caudas acima da reta. Isso √© evid√™ncia de que os erros n√£o apresentam distribui√ß√£o Normal, e por isso n√£o seguem a suposi√ß√£o do modelo, de forma que o modelo n√£o est√° bem ajustado. 

```{r modNormal,fig.align='center'}
mod1 <- lm(TEMPO ~ TI + TII + TIII + TIV + TV + TVI + TVII + TVIII + TIX,dados)
kable(anova(mod1))

#An√°lise de res√≠duos para modelo normal
resanalysis <- function(model){
  #RESIDUOS, DISTANCIA DE COOK E PONTOS INFLUENTES
  res <- rstandard(model)
  fit <- model$fitted.values
  cook <- cooks.distance(model)
  influ <- influence(model)$hat
   
  #GRAFICO DE RESIDUOS
  p1 <- {ggplot(data.frame(fit,res),aes(x = fit,y = res)) + geom_point() + theme_linedraw() + titles + 
      geom_hline(yintercept = c(-2,0,2)) + xlab("Valores ajustados") + ylab("Res√≠duos padronizados") +
      ggtitle("Grafico dos res√≠duos padronizados")}
  
  #QQ-PLOT
  g1 <- ggplot(data.frame(res), aes(sample = res))
  y <- quantile(res[!is.na(res)], c(0.25, 0.75))
  x <- qnorm(c(0.25, 0.75))
  slope <- diff(y)/diff(x)
  int <- y[1L] - slope * x[1L]
  p2 <- {g1 + stat_qq() + theme_linedraw() + geom_abline(slope = slope, intercept = int) +
      titles + xlab("Quantis te√≥ricos") + ylab("Res√≠duos padronizados") + ggtitle("QQ-Plot")}
  
  #GRAFICO DAS DISTANCIAS DE COOK
  obs <- 1:length(res)
  g3 <- data.frame(1:length(res),cook)
  colnames(g3) <- c("obs","cook")
  p3 <- {ggplot(g3,aes(x = obs,y = cook)) + geom_point() + theme_linedraw() + titles + xlab("Observa√ß√£o") + 
      ylab("Dist√¢ncia de Cook") + ggtitle("Dist√¢ncia de Cook") + geom_hline(yintercept = 4/length(res)) +
  annotate("text",size = 3,x = obs[rank(cook) == length(res)]+log(log(length(res)))*(0.75),y = cook[rank(cook) == length(res)],label = as.character(obs[rank(cook) == length(res)])) +
  annotate("text",size = 3,x = obs[rank(cook) == length(res)-1]+log(log(length(res)))*(0.75),y = cook[rank(cook) == length(res)-1],label = as.character(obs[rank(cook) == length(res)-1]))+
  annotate("text",size = 3,x = obs[rank(cook) == length(res)-2]+log(log(length(res)))*(0.75),y = cook[rank(cook) == length(res)-2],label = as.character(obs[rank(cook) == length(res)-2]))}
  
  #GRAFICO DE INFLUENCIA
  g4 <- data.frame(1:length(res),influ)
  colnames(g4) <- c("obs","influ")
  p4 <- {ggplot(g4,aes(x = obs,y = influ)) + geom_point() + theme_linedraw() + titles + xlab("Observa√ß√£o") + 
           ylab("Hat matrix diagonal") + ggtitle("Influ√™ncia")+
           annotate("text",size = 3,x = obs[rank(influ) == length(res)]+log(log(length(res)))*(0.75),y = influ[rank(influ) == length(res)],label = as.character(obs[rank(influ) == length(res)])) +
           annotate("text",size = 3,x = obs[rank(influ) == length(res)-1]+log(log(length(res)))*(0.75),y = influ[rank(influ) == length(res)-1],label = as.character(obs[rank(influ) == length(res)-1]))+
           annotate("text",size = 3,x = obs[rank(influ) == length(res)-2]+log(log(length(res)))*(0.75),y = influ[rank(influ) == length(res)-2],label = as.character(obs[rank(influ) == length(res)-2]))}
  
  p <- grid.arrange(p1,p2,p3,p4,nrow = 2,ncol = 2)
  r <- list(p)
  names(r) <- c("plot")
  return(r)
}
r <- resanalysis(mod1)
```

Ap√≥s uma transforma√ß√£o do tempo pelo logaritmo ajustamos um novo Modelo de Regress√£o Linear Normal. Novamente, vemos pela an√°lise de res√≠duos que o modelo n√£o est√° bem ajustado e, novamente, analisando-se o gr√°fico QQ-plot dos res√≠duos padronizados pelos quantis te√≥ricos, tem-se que os pontos n√£o est√£o bem ajustados sobre a reta diagonal, apresentando caudas acima da reta. Isso √© evid√™ncia de que os erros n√£o apresentam distribui√ß√£o Normal, e por isso n√£o seguem a suposi√ß√£o do modelo, de forma que o modelo n√£o est√° bem ajustado. 

```{r modNormalLog,fig.align='center'}
mod2 <- lm(log(TEMPO) ~ TI + TII + TIII + TIV + TV + TVI + TVII + TVIII + TIX,dados)
kable(anova(mod2))
r <- resanalysis(mod2)
```

Agora ajustamos um Modelo de Regress√£o com resposta exponencial (GLM), no qual observamos, pela an√°lise dos res√≠duos, que o modelo parece estar bem ajustado, j√° que eles se comportam como uma amostra de uma Distribui√ß√£o Normal. Observamos que, a um n√≠vel de signific√¢ncia estat√≠stica de 5\%, temos que uma ADIN ser de um determinado tema, de qualquer t√≠tulo que seja, n√£o altera o tempo em que est√° fora de pauta, pois nenhum dos p-valores est√£o abaixo de 0,05. A uma signific√¢ncia de 10\%, apenas o tema T√≠tulo I influencia o tempo que a ADIN permanece fora de pauta, pois seu p-valor √© menor do que 0,10.
 
```{r modExp,fig.align='center',results = 'hide'}
mod3 <- gamlss(TEMPO ~ TI + TII + TIII + TIV + TV + TVI + TVII + TVIII + TIX,data = dados,
               family = EXP())
s3 <- summary(mod3)
```

```{r modExp2,fig.align='center'}
kable(s3)
plot(mod3)
```

Por fim, tamb√©m ajustamos um Modelo de Regress√£o com resposta Gama. Aqui, tamb√©m observamos, pela an√°lise dos res√≠duos, que o modelo parece estar bem ajustado. Assim como para o Modelo Exponencial, a um n√≠vel de signific√¢ncia estat√≠stica de 5\%, temos que uma ADIN ser de um determinado tema, de qualquer t√≠tulo que seja, n√£o altera o tempo em que est√° fora de pauta, pois nenhum dos p-valores est√£o abaixo de 0,05. Ainda, a uma signific√¢ncia de 10\%, apenas o tema T√≠tulo I influencia o tempo que a ADIN permanece fora de pauta, pois seu p-valor √© menor do que 0,10.

```{r modGam,fig.align='center',results = 'hide'}
mod4 <- gamlss(TEMPO ~ TI + TII + TIII + TIV + TV + TVI + TVII + TVIII + TIX,data = dados,
               family = GA())
s4 <- summary(mod4)
```

```{r modGam2,fig.align='center'}
kable(s4)
plot(mod4)
```
 
**Conclu√≠mos assim que, a uma signific√¢ncia de 5\%, a presen√ßa de nenhum tema influencia o tempo em que uma ADIN permanece fora de pauta. J√° a uma signific√¢ncia de 10\%, apenas a presen√ßa do tema T√≠tulo I influencia o tempo em que uma ADIN permanece fora de pauta.**


